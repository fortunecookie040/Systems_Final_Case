<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Monthly Budget Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #fdfcfb;
      --bg-grad-top: #fdfcfb;
      --bg-grad-bottom: #fce7f3;
      --card: #ffffff;
      --border: #e5e7eb;
      --text: #111827;
      --muted: #6b7280;
      --accent: #f97316;
      --accent-soft: #ffedd5;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      background: linear-gradient(180deg, var(--bg-grad-top), var(--bg-grad-bottom));
      min-height: 100vh;
    }
    header {
      padding: 20px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand-icon {
      width: 38px;
      height: 38px;
      border-radius: 14px;
      display: grid;
      place-items: center;
      font-size: 20px;
      background: #fed7aa;
      border: 1px solid #fdba74;
      box-shadow: 0 4px 12px rgba(0,0,0,0.07);
    }
    .brand-text h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .brand-text span.badge {
      font-size: 10px;
      text-transform: uppercase;
      background: rgba(255,255,255,0.8);
      border-radius: 999px;
      padding: 2px 8px;
      border: 1px solid rgba(0,0,0,0.05);
      color: var(--muted);
    }
    .brand-text p {
      margin: 2px 0 0;
      font-size: 12px;
      color: var(--muted);
    }
    main {
      max-width: 1080px;
      margin: 0 auto 40px;
      padding: 0 16px 24px;
      display: grid;
      grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
      gap: 18px;
    }
    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: var(--card);
      border-radius: 18px;
      border: 1px solid var(--border);
      padding: 16px 16px 18px;
      box-shadow: 0 10px 28px rgba(15, 23, 42, 0.06);
    }
    .card h2 {
      margin: 0 0 10px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      background: var(--accent-soft);
      border-radius: 999px;
      padding: 4px 10px;
      color: #9a3412;
    }
    .pill-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
    }
    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 4px;
    }
    input, select, button {
      font: inherit;
      border-radius: 12px;
      border: 1px solid var(--border);
      padding: 10px 12px;
      width: 100%;
      outline: none;
      background: #ffffff;
      color: var(--text);
      transition: box-shadow 0.15s ease, border-color 0.15s ease, transform 0.05s ease;
    }
    input:focus, select:focus {
      border-color: #f97316;
      box-shadow: 0 0 0 2px rgba(249,115,22,0.18);
    }
    button {
      cursor: pointer;
      background: linear-gradient(135deg, #f97316, #fb923c);
      color: white;
      border-color: transparent;
      font-weight: 500;
    }
    button:hover {
      filter: brightness(0.97);
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(249,115,22,0.35);
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .btn-secondary {
      background: #f3f4f6;
      color: #374151;
      border-color: #e5e7eb;
      box-shadow: none;
    }
    .btn-secondary:hover {
      box-shadow: 0 4px 10px rgba(148,163,184,0.35);
    }
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }
    .row {
      margin-bottom: 10px;
    }
    .note {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
    }
    .kpi-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .kpi {
      border-radius: 14px;
      border: 1px dashed #e5e7eb;
      background: #f9fafb;
      padding: 8px 10px;
      font-size: 12px;
    }
    .kpi span.label {
      display: block;
      color: var(--muted);
      margin-bottom: 2px;
    }
    .kpi span.value {
      font-size: 16px;
      font-weight: 600;
    }
    .chart-shell {
      border-radius: 14px;
      border: 1px dashed #e5e7eb;
      background: #f9fafb;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      height: 360px;
    }
    .chart-shell header {
      padding: 0;
      justify-content: space-between;
    }
    .chart-shell h3 {
      margin: 0;
      font-size: 13px;
      color: #4b5563;
    }
    .chart-meta {
      font-size: 11px;
      color: var(--muted);
    }
    iframe, img {
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: white;
      flex: 1;
    }
    footer {
      text-align: center;
      font-size: 11px;
      color: var(--muted);
      padding: 10px 16px 18px;
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="brand-icon">ðŸ’¸</div>
      <div class="brand-text">
        <h1>BudgetScope <span class="badge">monthly tracker</span></h1>
        <p>Track daily spending against a monthly cap, and see how fast youâ€™re burning through it.</p>
      </div>
    </div>
  </header>

  <main>
    <!-- LEFT: controls -->
    <section class="card">
      <h2>
        Budget & Inputs
        <span class="pill"><span class="pill-dot"></span> monthly cap</span>
      </h2>

      <form id="budgetForm">
        <div class="row">
          <label for="budget">Monthly budget (total)</label>
          <input id="budget" name="budget" type="number" min="0" step="1" placeholder="1000" required>
          <p class="note">This is the total youâ€™re allowed to spend for the entire month.</p>
        </div>

        <div class="grid-2">
          <div class="row">
            <label for="spending">Spending for this date</label>
            <input id="spending" name="spending" type="number" min="0" step="1" placeholder="e.g., 35" required>
          </div>
          <div class="row">
            <label for="date">Date</label>
            <input id="date" name="date" type="date" required>
          </div>
        </div>

        <div class="row">
          <label for="view">View range</label>
          <select id="view" name="view">
            <option value="week">Week of this date (Monâ€“Sun)</option>
            <option value="month" selected>Month of this date</option>
          </select>
        </div>

        <div class="grid-2" style="margin-top: 10px;">
          <button type="submit">Log spending & update plot</button>
          <button type="button" class="btn-secondary" id="refreshBtn">Refresh current plot</button>
        </div>
      </form>

      <div class="kpi-row">
        <div class="kpi">
          <span class="label">Last logged date</span>
          <span class="value" id="kpiDate">â€”</span>
        </div>
        <div class="kpi">
          <span class="label">Last spending added</span>
          <span class="value" id="kpiSpend">â€”</span>
        </div>
        <div class="kpi">
          <span class="label">Monthly budget</span>
          <span class="value" id="kpiBudget">â€”</span>
        </div>
      </div>

      <p class="note" style="margin-top:10px;">
        Each time you submit the form, the server remembers spending for that exact date
        (while the app is running) and recomputes remaining budget across the month.
      </p>
    </section>

    <!-- RIGHT: chart -->
    <section class="card">
      <div class="chart-shell">
        <header>
          <h3>Remaining budget vs. daily spending</h3>
          <div class="chart-meta" id="chartMeta">No data yet â€” log something to see the plot.</div>
        </header>
        <img id="plotImg" alt="Budget plot will appear here" />
      </div>
    </section>
  </main>

  <footer>
    Systems Final â€¢ Flask + Docker demo Â· Remaining = monthly budget âˆ’ cumulative spending.
  </footer>

<script>
(function() {
  const form = document.getElementById("budgetForm");
  const refreshBtn = document.getElementById("refreshBtn");
  const plotImg = document.getElementById("plotImg");
  const kpiDate = document.getElementById("kpiDate");
  const kpiSpend = document.getElementById("kpiSpend");
  const kpiBudget = document.getElementById("kpiBudget");
  const chartMeta = document.getElementById("chartMeta");

  const budgetInput = document.getElementById("budget");
  const spendingInput = document.getElementById("spending");
  const dateInput = document.getElementById("date");
  const viewInput = document.getElementById("view");

  // Default date = today
  const today = new Date();
  const isoToday = today.toISOString().slice(0, 10);
  dateInput.value = isoToday;

  function buildPlotUrl() {
    const params = new URLSearchParams();
    params.set("budget", budgetInput.value || "0");
    params.set("spending", spendingInput.value || "0");
    params.set("date", dateInput.value || isoToday);
    params.set("view", viewInput.value || "month");
    params.set("_t", Date.now().toString()); // cache-buster
    return `/budget_plot?${params.toString()}`;
  }

  function updateKpis() {
    kpiDate.textContent = dateInput.value || "â€”";
    kpiSpend.textContent = spendingInput.value ? (spendingInput.value + " units") : "â€”";
    kpiBudget.textContent = budgetInput.value ? (budgetInput.value + " units") : "â€”";
  }

  form.addEventListener("submit", function(e) {
    e.preventDefault();
    const url = buildPlotUrl();
    plotImg.src = url;
    updateKpis();
    chartMeta.textContent = `Showing ${viewInput.value === "week" ? "weekly" : "monthly"} view based on ${dateInput.value}`;
  });

  refreshBtn.addEventListener("click", function() {
    if (!budgetInput.value || !dateInput.value) {
      alert("Enter at least a budget and date before refreshing the plot.");
      return;
    }
    const url = buildPlotUrl();
    plotImg.src = url;
    chartMeta.textContent = `Refreshed view for ${dateInput.value}`;
  });
})();
</script>
</body>
</html>
